define(["jquery","core/yui","core/str","core/config","mod_openstudio/osdialogue"],function(a,b,c,d,e){var f;return f={dialogue:null,mconfig:null,CSS:{DIALOGHEADER:".openstudio-export-header",BOUNDINGBOX:".openstudio-export-dialog-container",EXPORTBUTTON:"#osep-bottombutton-export",EXPORTMESSAGE:".openstudio-export-message",SELECTALLPOST:'button[name="openstudio-export-select-all"]',SELECTNONE:'button[name="openstudio-export-select-none"]',EXPORTSELECTED:'button[name="openstudio-export-selected"]',CHECKBOXS:'.openstudio-export-items input[type="checkbox"][data-contentid]'},init:function(b){f.mconfig=b,f.dialogue=f.createExportDialogue(),a(f.CSS.EXPORTBUTTON).on("click",function(a){a.preventDefault(),f.dialogue.show()}),a(f.CSS.SELECTALLPOST).on("click",f.selectAll.bind(f)),a(f.CSS.SELECTNONE).on("click",f.selectNone.bind(f)),a(f.CSS.EXPORTSELECTED).on("click",f.exportSelected.bind(f)),a(f.CSS.CHECKBOXS).on("click",f.selectPost.bind(f)),a(window).resize(f.resize.bind(f))},createExportDialogue:function(){function b(){var a;c.get_string("exportdialogheader","mod_openstudio").done(function(b){a=b}).always(function(){i.set("headerContent",'<span class="'+f.CSS.DIALOGHEADER.replace(".","")+'">'+a+"</span>")})}function g(){var b,d;c.get_strings([{key:"exportdialogcontent",component:"mod_openstudio"},{key:"export:emptycontent",component:"mod_openstudio"}]).done(function(a){b=a[0],d=a[1]}).always(function(){b+='<div class="'+f.CSS.EXPORTMESSAGE.replace(".","")+'"></div>',i.set("bodyContent",b),a(f.CSS.EXPORTMESSAGE).text(d)})}function h(){var b={name:"exportall",classNames:"openstudio-exportall-btn",events:{click:f.exportAll.bind(f)}},e={name:"exportselected",classNames:"openstudio-exportselected-btn",events:{click:function(){var b=f.mconfig.contentids.join();b?f.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/exportposts.php",data:{id:f.mconfig.id,vid:f.mconfig.vid,contentids:b}}):a(f.CSS.EXPORTMESSAGE).show()}}},g={name:"cancel",classNames:"openstudio-cancelexport-btn",action:"hide"};c.get_strings([{key:"exportall",component:"mod_openstudio"},{key:"exportselectedpost",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){b.label=a[0],e.label=a[1],g.label=a[2]}).always(function(){i.addButton(b,["footer"]),i.addButton(e,["footer"]),i.addButton(g,["footer"])})}var i=new e({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521,extraClasses:[f.CSS.BOUNDINGBOX.replace(".","")]});return b(),g(),h(),i},exportAll:function(){var b=f.mconfig.contentids.join();b?f.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/export.php",data:{id:f.mconfig.id,contentids:b}}):a(f.CSS.EXPORTMESSAGE).show()},exportSelected:function(){var b=[];a(f.CSS.CHECKBOXS).each(function(){1==a(this).prop("checked")&&b.push(a(this).data("contentid"))}),b.length>0&&f.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/export.php",data:{id:f.mconfig.id,contentids:b.join()}})},resize:function(){f.dialogue.get("visible")&&(b.one("body").get("winWidth")<=767?f.dialogue.makeResponsive():f.dialogue.centerDialogue())},redirectPostRequest:function(b){var c=a("<form></form>");c.attr({method:"POST",action:b.url,style:"display: none;"}),a.each(b.data,function(b,d){var e=a("<input/>");e.attr("type","hidden"),e.attr("name",b),e.attr("value",d),c.append(e)}),a(c).appendTo("body").submit()},selectAll:function(){a(f.CSS.CHECKBOXS).prop("checked",!0),a(f.CSS.SELECTALLPOST).addClass("disabled"),a(f.CSS.EXPORTSELECTED).removeClass("disabled"),a(f.CSS.SELECTNONE).removeClass("disabled")},selectNone:function(){a(f.CSS.CHECKBOXS).prop("checked",!1),a(f.CSS.SELECTALLPOST).removeClass("disabled"),a(f.CSS.EXPORTSELECTED).addClass("disabled"),a(f.CSS.SELECTNONE).addClass("disabled")},selectPost:function(){var b=0,c=0;a(f.CSS.CHECKBOXS).each(function(){0==a(this).prop("checked")&&b++,c++}),a(f.CSS.SELECTALLPOST).toggleClass("disabled",0==b),a(f.CSS.SELECTNONE).toggleClass("disabled",b==c),a(f.CSS.EXPORTSELECTED).toggleClass("disabled",b==c)}}});
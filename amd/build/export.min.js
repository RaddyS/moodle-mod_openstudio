define(["jquery","core/yui","core/str","core/config","mod_openstudio/osdialogue"],function(a,b,c,d){var e;return e={dialogue:null,mconfig:null,CSS:{DIALOGHEADER:".openstudio-export-header",BOUNDINGBOX:".openstudio-export-dialog-container",EXPORTBUTTON:"#osep-bottombutton-export",EXPORTMESSAGE:".openstudio-export-message",SELECTALLPOST:'button[name="openstudio-export-select-all"]',SELECTNONE:'button[name="openstudio-export-select-none"]',EXPORTSELECTED:'button[name="openstudio-export-selected"]',CHECKBOXS:'.openstudio-export-items input[type="checkbox"][data-contentid]'},init:function(c){e.mconfig=c,b.use("moodle-core-notification-dialogue",function(){require(["mod_openstudio/osdialogue"],function(a){e.dialogue=e.createExportDialogue(a)})}),a(e.CSS.EXPORTBUTTON).on("click",function(a){a.preventDefault(),e.dialogue.show()}),a(e.CSS.SELECTALLPOST).on("click",e.selectAll.bind(e)),a(e.CSS.SELECTNONE).on("click",e.selectNone.bind(e)),a(e.CSS.EXPORTSELECTED).on("click",e.exportSelected.bind(e)),a(e.CSS.CHECKBOXS).on("click",e.selectPost.bind(e)),a(window).resize(e.resize.bind(e))},createExportDialogue:function(b){function f(){var a;c.get_string("exportdialogheader","mod_openstudio").done(function(b){a=b}).always(function(){i.set("headerContent",'<span class="'+e.CSS.DIALOGHEADER.replace(".","")+'">'+a+"</span>")})}function g(){var b,d;c.get_strings([{key:"exportdialogcontent",component:"mod_openstudio"},{key:"export:emptycontent",component:"mod_openstudio"}]).done(function(a){b=a[0],d=a[1]}).always(function(){b+='<div class="'+e.CSS.EXPORTMESSAGE.replace(".","")+'"></div>',i.set("bodyContent",b),a(e.CSS.EXPORTMESSAGE).text(d)})}function h(){var b={name:"exportall",classNames:"openstudio-exportall-btn",events:{click:e.exportAll.bind(e)}},f={name:"exportselected",classNames:"openstudio-exportselected-btn",events:{click:function(){var b=e.mconfig.contentids.join();b?e.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/exportposts.php",data:{id:e.mconfig.id,vid:e.mconfig.vid,contentids:b}}):a(e.CSS.EXPORTMESSAGE).show()}}},g={name:"cancel",classNames:"openstudio-cancelexport-btn",action:"hide"};c.get_strings([{key:"exportall",component:"mod_openstudio"},{key:"exportselectedpost",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){b.label=a[0],f.label=a[1],g.label=a[2]}).always(function(){i.addButton(b,["footer"]),i.addButton(f,["footer"]),i.addButton(g,["footer"])})}var i=new b({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521,extraClasses:[e.CSS.BOUNDINGBOX.replace(".","")]});return f(),g(),h(),i},exportAll:function(){var b=e.mconfig.contentids.join();b?e.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/export.php",data:{id:e.mconfig.id,contentids:b}}):a(e.CSS.EXPORTMESSAGE).show()},exportSelected:function(){var b=[];a(e.CSS.CHECKBOXS).each(function(){1==a(this).prop("checked")&&b.push(a(this).data("contentid"))}),b.length>0&&e.redirectPostRequest({url:d.wwwroot+"/mod/openstudio/export.php",data:{id:e.mconfig.id,contentids:b.join()}})},resize:function(){e.dialogue.get("visible")&&(b.one("body").get("winWidth")<=767?e.dialogue.makeResponsive():e.dialogue.centerDialogue())},redirectPostRequest:function(b){var c=a("<form></form>");c.attr({method:"POST",action:b.url,style:"display: none;"}),a.each(b.data,function(b,d){var e=a("<input/>");e.attr("type","hidden"),e.attr("name",b),e.attr("value",d),c.append(e)}),a(c).appendTo("body").submit()},selectAll:function(){a(e.CSS.CHECKBOXS).prop("checked",!0),a(e.CSS.SELECTALLPOST).addClass("disabled"),a(e.CSS.EXPORTSELECTED).removeClass("disabled"),a(e.CSS.SELECTNONE).removeClass("disabled")},selectNone:function(){a(e.CSS.CHECKBOXS).prop("checked",!1),a(e.CSS.SELECTALLPOST).removeClass("disabled"),a(e.CSS.EXPORTSELECTED).addClass("disabled"),a(e.CSS.SELECTNONE).addClass("disabled")},selectPost:function(){var b=0,c=0;a(e.CSS.CHECKBOXS).each(function(){0==a(this).prop("checked")&&b++,c++}),a(e.CSS.SELECTALLPOST).toggleClass("disabled",0==b),a(e.CSS.SELECTNONE).toggleClass("disabled",b==c),a(e.CSS.EXPORTSELECTED).toggleClass("disabled",b==c)}}});
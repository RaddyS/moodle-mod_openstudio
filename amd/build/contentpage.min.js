define(["jquery","core/ajax","core/str","core/modal","core/templates"],function(a,b,c,d,e){var f;return f={init:function(){a.fx.off=!0,f.createMaximizeModal(),a("#openstudio_content_view_maximize").on("click",f.toogleContentModal),a("body").delegate("#openstudio_content_view_minimize","click",f.toogleContentModal),a("body").delegate(".openstudio-modal-content-close","click",f.toogleContentModal);var b=a("#openstudio_content_view_map_canvas");b.length&&f.showGoogleMap(b),a(".openstudio-content-view-flag-icon").bind("click",function(){f.doFlagContent(a(this))})},createMaximizeModal:function(){e.render("mod_openstudio/content_modal",{title:a(".openstudio-content-view-title").text(),body:a(".openstudio-content-view-file").html(),date:a(".openstudio-content-view-date").html(),isiframecontent:a(".openstudio-content-view-file").find("iframe").length>0}).done(function(a){f.modal=new d(a),f.modal.setLarge()})},toogleContentModal:function(){f.modal&&(f.modal.isVisible()?f.modal.hide():f.modal.show(),a("body").toggleClass("openstudio-lockscroll"))},showGoogleMap:function(a){var b=a.attr("data-gpslat"),c=a.attr("data-gpslng");if(b&&c){var d={lat:parseFloat(b),lng:parseFloat(c)};map=new google.maps.Map(document.getElementById("openstudio_content_view_map_canvas"),{center:d,zoom:14}),new google.maps.Marker({position:d,map:map})}},doFlagContent:function(c){var d=b.call([{methodname:"mod_openstudio_external_flag_content",args:{cmid:c.attr("data-cmid"),cid:c.attr("data-cid"),fid:c.attr("data-fid"),mode:c.attr("data-mode")}}]);d[0].done(function(b){if(b.success){var c=a("#content_view_icon_"+b.fid);c.attr("data-mode",b.mode),c.html(b.flagtext),c.removeClass(b.flagremoveclass).addClass(b.flagaddclass)}}).fail(function(a){window.console.error("Error saving social flag "+a.message)})}}});
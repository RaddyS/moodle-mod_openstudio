define(["jquery","core/ajax","core/str"],function(a,b,c){var d;return d={mconfig:null,CSS:{ACTIVITY_UNLOCK_ICON:'span[name="activitylockbutton"]',ACTIVITY_UNLOCK_BUTTON:".openstudio-unlock-ok-btn"},init:function(b){d.mconfig=b,Y.use("moodle-core-notification-dialogue",function(){require(["mod_openstudio/osdialogue"],function(a){d.dialogue=d.createUnlockActivityDialogue(a)})}),a(d.CSS.ACTIVITY_UNLOCK_ICON).on("click",function(){d.dialogue&&(a(d.CSS.ACTIVITY_UNLOCK_BUTTON).attr("data-level3id",a(this).attr("data-level3id")).attr("data-vuid",a(this).attr("data-vuid")),d.dialogue.show())}),a("body").delegate(d.CSS.ACTIVITY_UNLOCK_BUTTON,"click",d.unlockActivityContent),a(window).resize(d.resize.bind(d))},unlockActivityContent:function(){var c=a(this).attr("data-level3id"),e=a(this).attr("data-vuid");M.util.js_pending("openstudioUnlockActivity");var f=b.call([{methodname:"mod_openstudio_external_unlock_override_activity",args:{cmid:d.mconfig.cmid,level3id:c,vuid:e}}]);f[0].done(function(){window.location.reload()}).always(function(){M.util.js_complete("openstudioUnlockActivity")}).fail(function(a){window.console.error("Log request failed "+a.message)})},createUnlockActivityDialogue:function(a){function b(){c.get_string("contentactionunlockname","mod_openstudio").done(function(a){g.set("headerContent","<span>"+a+"</span>")})}function e(){c.get_string("modulejsdialogcontentunlock","mod_openstudio").done(function(a){g.set("bodyContent",a)})}function f(){var a={name:"cancel",action:"hide"},b={name:"lock",classNames:d.CSS.ACTIVITY_UNLOCK_BUTTON.replace(".","")};c.get_strings([{key:"modulejsdialogcancel",component:"mod_openstudio"},{key:"contentactionunlockname",component:"mod_openstudio"}]).done(function(c){a.label=c[0],b.label=c[1],g.addButton(b,["footer"]),g.addButton(a,["footer"])})}var g=new a({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0});return b(),e(),f(),g},resize:function(){d.dialogue&&d.dialogue.get("visible")&&(Y.one("body").get("winWidth")<=d.dialogue.get("responsiveWidth")?d.dialogue.makeResponsive():d.dialogue.centerDialogue())}}});